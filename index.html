<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Caisse Club</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>üí∞ Gestion de la Caisse du Club</h1>

  <!-- Section Transactions -->
  <section id="transactions-section">
    <h2>Transactions</h2>
    <form id="transaction-form">
      <input type="hidden" id="transaction-id">
      <label>Type:</label>
      <select id="transaction-type">
        <option value="recette">Recette</option>
        <option value="d√©pense">D√©pense</option>
      </select>
      <label>Description:</label>
      <input type="text" id="transaction-description" required>
      <label>Montant:</label>
      <input type="number" id="transaction-amount" required>
      <label>Cat√©gorie:</label>
      <input type="text" id="transaction-category">
      <button type="submit">Ajouter / Modifier</button>
    </form>

    <table id="transactions-table">
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
          <th>Montant</th>
          <th>Cat√©gorie</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Section Membres -->
  <section id="members-section">
    <h2>Membres</h2>
    <form id="member-form">
      <input type="hidden" id="member-id">
      <label>Pr√©nom:</label>
      <input type="text" id="member-firstname" required>
      <label>Nom:</label>
      <input type="text" id="member-lastname" required>
      <label>Montant cotis√©:</label>
      <input type="number" id="member-amount" required>
      <label>Pay√©:</label>
      <input type="checkbox" id="member-paid">
      <button type="submit">Ajouter / Modifier</button>
    </form>

    <table id="members-table">
      <thead>
        <tr>
          <th>Pr√©nom</th>
          <th>Nom</th>
          <th>Montant</th>
          <th>Pay√©</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Solde -->
  <section id="balance-section">
    <h2>üíµ Solde actuel : <span id="balance">0</span> DT</h2>
  </section>

  <!-- Graphiques -->
  <section id="charts-section">
    <h2>üìä Statistiques</h2>
    <canvas id="transactions-chart"></canvas>
    <canvas id="members-chart"></canvas>
  </section>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>

  <script>
  /* === CONFIG FIREBASE (remplace par la tienne) === */
  const firebaseConfig = {
  apiKey: "AIzaSyAOFzbsKa6b9_9XMPNiP8VDJdhnuTqGyh0",
  authDomain: "caisse-club.firebaseapp.com",
  projectId: "caisse-club",
  storageBucket: "caisse-club.firebasestorage.app",
  messagingSenderId: "410619067499",
  appId: "1:410619067499:web:5ae5a65a645c4b1634052e",
  measurementId: "G-PEVSBVTZWV"
};
  /* =============================================== */

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  firebase.auth().signInAnonymously();

  let transactions = [];
  let members = [];

  /* --- Transactions --- */
  async function saveTransaction(t) {
    await db.collection("transactions").doc(String(t.id)).set(t);
  }
  async function deleteTransaction(id) {
    await db.collection("transactions").doc(String(id)).delete();
  }

  /* --- Membres --- */
  async function saveMember(m) {
    await db.collection("members").doc(String(m.id)).set(m);
  }
  async function deleteMember(id) {
    await db.collection("members").doc(String(id)).delete();
  }

  /* --- Sync automatique --- */
  db.collection("transactions").orderBy("timestamp","asc").onSnapshot(snap=>{
    transactions = snap.docs.map(d=>d.data());
    updateUI();
  });

  db.collection("members").orderBy("timestamp","asc").onSnapshot(snap=>{
    members = snap.docs.map(d=>d.data());
    updateUI();
  });

  /* === UI Functions (√† adapter avec ton code existant) === */
  function updateUI() {
    // Afficher transactions
    const tbody = document.querySelector("#transactions-table tbody");
    tbody.innerHTML = "";
    let balance = 0;
    transactions.forEach(t=>{
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${t.type}</td>
        <td>${t.description}</td>
        <td>${t.amount} DT</td>
        <td>${t.category}</td>
        <td>${new Date(t.timestamp).toLocaleString()}</td>
        <td>
          <button onclick="deleteTransaction(${t.id})">Supprimer</button>
        </td>`;
      tbody.appendChild(row);
      balance += (t.type === "recette" ? t.amount : -t.amount);
    });
    document.getElementById("balance").textContent = balance.toFixed(2);

    // Afficher membres
    const mbody = document.querySelector("#members-table tbody");
    mbody.innerHTML = "";
    members.forEach(m=>{
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${m.firstName}</td>
        <td>${m.lastName}</td>
        <td>${m.amount} DT</td>
        <td>${m.paid ? "‚úÖ" : "‚ùå"}</td>
        <td>
          <button onclick="deleteMember(${m.id})">Supprimer</button>
        </td>`;
      mbody.appendChild(row);
    });
  }

  /* === Gestion Formulaires === */
  document.getElementById("transaction-form").addEventListener("submit", e=>{
    e.preventDefault();
    const t = {
      id: Date.now(),
      type: document.getElementById("transaction-type").value,
      description: document.getElementById("transaction-description").value,
      amount: parseFloat(document.getElementById("transaction-amount").value),
      category: document.getElementById("transaction-category").value,
      timestamp: new Date().toISOString()
    };
    saveTransaction(t);
    e.target.reset();
  });

  document.getElementById("member-form").addEventListener("submit", e=>{
    e.preventDefault();
    const m = {
      id: Date.now(),
      firstName: document.getElementById("member-firstname").value,
      lastName: document.getElementById("member-lastname").value,
      amount: parseFloat(document.getElementById("member-amount").value),
      paid: document.getElementById("member-paid").checked,
      timestamp: new Date().toISOString()
    };
    saveMember(m);
    e.target.reset();
  });
  </script>
</body>
</html>
